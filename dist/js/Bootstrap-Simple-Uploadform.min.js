!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";a.fn.bsUploadform=function(b){var c={defaultIcon:"<i class='glyphicon glyphicon-file'></i>",filetypeIcons:{image:"<i class='glyphicon glyphicon-camera'></i>",audio:"<i class='glyphicon glyphicon-music'></i>"},onServerResponse:function(){}},d=a.extend({},c,b);return this.each(function(){function c(){f.addClass("uploadform"),g=a(f).find("input[type=file]"),h=a(f).find(".openDialog"),i=a(f).find(".progress-bar"),j=a(f).find(".btnUpload"),m=a(f).find(".fileContainer"),k=a(f).find(".btn-close"),l=a(f).find(".close"),a(j).attr("disabled","disabled"),d.url=a(f).find("form").attr("action"),a(f).find(".folder").length>0&&(p=a(f).find(".folder")),a(h).unbind(),a(h).click(function(a){a.preventDefault(),g.click()}),a(g).unbind(),a(g).change(function(){s=0,t=0,u=0,m.html(""),i.css("width","0%"),n=this.files,o=this.files.length,w()}),a(j).unbind(),a(j).click(function(b){b.preventDefault(),y(),a(h).attr("disabled","disabled"),a(j).attr("disabled","disabled"),a(k).attr("disabled","disabled"),a(l).hide(),null!==p&&a(p).attr("readonly","readonly")})}function e(){f.removeClass("uploadform"),a(h).unbind(),a(g).unbind(),a(j).unbind(),f=null,g=null,h=null,i=null,j=null,k=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null}var f=a(this),g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=new XMLHttpRequest,r=null,s=0,t=0,u=0,v=function(a){for(var b=0;a>1023;)a/=1024,b+=1;return b?a.toFixed(2)+[""," KB"," MB"," GB"," TB"][b]:a+" Bytes"},w=function(){var b,c=null,e="",f=d.defaultIcon,g=null;for(b=0;o>b;b+=1){e="",c=n[b],t+=c.size;for(g in d.filetypeIcons)d.filetypeIcons.hasOwnProperty(g)&&c.type.indexOf(g)>-1&&(f=d.filetypeIcons[g]);e+="<li class='col-lg-12'>",e+="<div class='filetype col-lg-1'>"+f+"</div>",e+="<strong class='filename col-lg-8'>"+c.name+"</strong>",e+="<small class='filesize muted col-lg-3 text-right'>"+v(c.size)+"</small>",e+='<div class="clearfix"></div>',e+="</li>",m.append(e)}a(j).removeAttr("disabled")},x=function(){return i.css("width","100%"),m.empty(),n=null,s=0,i.css("width","0%"),a(h).removeAttr("disabled"),a(k).removeAttr("disabled"),a(l).show(),null!==p&&a(p).removeAttr("readonly"),!1},y=function(){if(s===o)return x(),!1;var b=n[s],c=d.url;r=new FormData,a(f).find(".folder").length>0&&(p=a(f).find(".folder")),p&&(c=d.url+"/"+p.val()+"/"),c+=o-1>s?"progress":"done",r.append("file",b),a("input",f).each(function(){var b=a(this).attr("id"),c=a(this).val();""!==c&&r.append(b,c)}),q.onerror=function(){x()},q.onload=function(){u+=n[s].size,s+=1,d.onServerResponse(q.responseText),y()},q.upload.onprogress=function(a){var b=u+a.loaded,c=Math.round(100*b/t);i.css("width",c+"%")},q.onabort=function(){x()},q.open("POST",c),q.send(r)};b&&"init"!==b&&"object"!=typeof b?"destroy"===b&&e():c()})}});